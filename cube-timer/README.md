# スピードキューブ・タイマー 🧊⏱

Pinecil V2 × Bambu Lab P2S × Arduino で作る、ルービックキューブ用のスピードキューブ・タイマーです。
SpeedStacks G5 Stackmat タイマーの挙動を再現します。

## 概要

SpeedStacks Stackmat と同様の操作方式:

- 両手をパッドに置く → タイマーリセット → 準備完了
- 両手を離す → スタート
- 両手を戻す → ストップ

```
┌──────────────────────────────────────────┐
│         ┌──────────────┐                 │
│         │  00.000 秒   │  [RST]          │
│         └──────────────┘                 │
│                                          │
│   ┌────┐┌────┐    ┌────┐┌────┐          │
│   │ SW1 ││ SW2 │    │ SW3 ││ SW4 │          │
│   └────┘└────┘    └────┘└────┘          │
│    左手パッド        右手パッド            │
└──────────────────────────────────────────┘
          3Dプリント筐体
```

## 動作フロー（Stackmat準拠）

```
                    ┌──[RST押下]──┐
                    ↓             │
[IDLE] ─(両手押下)→ [READY] ─(ホールド0.5秒)→ [SET]
                                                │
                                          (両手リリース)
                                                ↓
[IDLE] ←─(結果表示)── [STOPPED] ←─(両手押下)── [RUNNING]
```

| 状態        | OLED表示                   | 動作                              |
| :---------- | :------------------------- | :-------------------------------- |
| **IDLE**    | 前回タイム + Best/Avg      | 入力待ち                          |
| **READY**   | "0.000"                    | 両手がパッドを押している          |
| **SET**     | "0.000" (点滅) + ビープ    | 0.5秒ホールド完了。離すとスタート |
| **RUNNING** | カウントアップ中           | 計測中                            |
| **STOPPED** | 最終タイム + Best/Avg of 5 | 記録保存。次の計測待ち            |

## パーツリスト

### メイン部品

| #   | パーツ                    | 型番 / 仕様                             | Amazon検索キーワード            | 概算価格  | 備考                         |
| --- | :------------------------ | :-------------------------------------- | :------------------------------ | :-------- | :--------------------------- |
| 1   | **Arduino Nano**          | ATmega328P互換 (USB-C推奨)              | 「Arduino Nano 互換 USB-C」     | ¥500〜800 | 制御メイン                   |
| 2   | **OLEDディスプレイ**      | 1.3インチ I2C SSD1306                   | 「OLED 1.3インチ I2C」          | ¥500〜800 | タイム表示                   |
| 3   | **キーボードスイッチ** ×5 | Cherry MX互換 (手持ち6個から)           | —                               | ¥0        | 左2+右2+リセット1            |
| 4   | **キーキャップ**          | パッド用: 2Uまたは平面 / リセット用: 1U | 「キーキャップ 無刻印」         | ¥500〜800 | 手のひらで押しやすい形状推奨 |
| 5   | **アクティブブザー**      | 5V                                      | 「アクティブブザー 5V Arduino」 | ¥300      | ビープ音                     |
| 6   | **トグルスイッチ**        | ミニトグル ON/OFF (SPST)                | 「ミニ トグルスイッチ ON OFF」  | ¥200〜400 | 電源ON/OFF                   |

### 電源 (いずれか)

| 方式                  | パーツ                         | 概算価格    | メリット                       |
| :-------------------- | :----------------------------- | :---------- | :----------------------------- |
| **A. USB給電**        | USB-Cケーブル (手持ち)         | ¥0          | 最もシンプル。充電不要         |
| **B. 電池駆動**       | 単4×3本 電池ボックス + 単4電池 | ¥500〜800   | ケーブル不要。持ち運び◎        |
| **C. LiPoバッテリー** | 3.7V LiPo + 充電モジュール     | ¥800〜1,200 | 薄型化。ただし回路が複雑になる |

> 💡 **おすすめ:** 最初は **A. USB給電** で作って動作確認。後からBかCに拡張。

### その他

| パーツ                        | 備考                                                       |
| :---------------------------- | :--------------------------------------------------------- |
| **ダイオード** (1N4148) ×5    | スイッチのチャタリング防止。ソフトウェアデバウンスで代替可 |
| **プルアップ/プルダウン抵抗** | Arduino内蔵プルアップを使用するため不要                    |
| **筐体**                      | 3Dプリント (PLA or PETG)                                   |
|                               | **総額: 約 ¥2,000 〜 ¥3,000**                              |

## キーボードスイッチの配置

```
手持ちスイッチ 6個の割り当て:

[SW1][SW2]        [SW3][SW4]        [SW5]     [SW6]
 左手パッド        右手パッド       リセット   予備/機能切替
 (2個並列)         (2個並列)                  (Avg表示切替など)
```

- 左手パッド (SW1+SW2): 2個を並列接続 → どちらか押されれば「左手検知」
- 右手パッド (SW3+SW4): 同上
- 左右両方が押されて初めて「両手検知」と判定
- 3Dプリントで大きめの平面キャップを作れば、手のひら全体で押せる

## 配線図

```
Arduino Nano
├── A4 (SDA) ─────── OLED SDA
├── A5 (SCL) ─────── OLED SCL
├── D2 ──────────── SW1 (左手1) ──── GND   ※INPUT_PULLUP使用
├── D3 ──────────── SW2 (左手2) ──── GND
├── D4 ──────────── SW3 (右手1) ──── GND
├── D5 ──────────── SW4 (右手2) ──── GND
├── D6 ──────────── SW5 (リセット) ── GND
├── D7 ──────────── SW6 (予備) ───── GND
├── D8 ──────────── ブザー SIG
├── 5V ──────────── OLED VCC / ブザー VCC
├── GND ─────────── OLED GND / ブザー GND
│
└── VIN ←─[トグルスイッチ]─── 電源+ (USB or 電池)
```

> **補足:** Arduino Nanoの `INPUT_PULLUP` を使うので、スイッチはGNDに直結するだけでOK（外付き抵抗不要）。

## ソフトウェア設計

### 記録管理

- 直近の solve タイムを最大100件メモリに保持 (EEPROM or SRAM)
- Best (自己ベスト)
- Avg of 5: 直近5回の平均（最速・最遅を除いた3回の平均 = 競技ルール）
- Avg of 12: 直近12回の平均（最速・最遅を除いた10回の平均）

### 必要なライブラリ

- `Adafruit_SSD1306` — OLEDディスプレイ制御
- `Adafruit_GFX` — グラフィックス描画
- `Wire` — I2C通信 (標準ライブラリ)

## 3Dプリント筐体

### 設計方針

- **SpeedStacks G5風の横長フォームファクター**
- 2パーツ構成: ベース + トップカバー
- OLEDの窓穴 (中央)
- キーボードスイッチのマウントホール (Cherry MX互換: 14mm角)
- リセットボタン位置: 右上 (誤操作防止)
- トグルスイッチ: 側面 or 背面
- USB-Cアクセス用の開口部 (背面)
- 底面にゴム足用の穴 (滑り防止 — 重要！タイムアタック中に動くと困る)

### 推奨素材

- **筐体:** PLA (十分な強度)
- **パッドカバー:** TPU (柔らかい素材で手のひらに優しく) or 大型3Dプリントキーキャップ

## 組み立て手順

1. パーツ購入 & 到着待ち
2. 筐体を3Dプリント
3. ブレッドボードで仮組み & ファームウェア動作確認
4. はんだ付けで本配線（Pinecil V2 出番！🔥）
5. 筐体に組み込み
6. 完成 & テスト 🎉

## フォルダ構造

```
cube-timer/
├── README.md          ← このファイル
├── firmware/          ← Arduinoスケッチ
│   └── cube_timer/
│       └── cube_timer.ino
├── models/            ← 3Dモデル (STL, 3MF, CAD)
│   ├── case_base.stl
│   ├── case_top.stl
│   └── pad_cover.stl
└── docs/              ← 回路図、写真など
    └── wiring.md
```
