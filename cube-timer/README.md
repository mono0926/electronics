# スピードキューブ・タイマー 🧊⏱

![完成イメージ](images/完成イメージ.jpeg)

Pinecil V2 × Bambu Lab P2S × Arduino で作る、ルービックキューブ用のスピードキューブ・タイマーです。
SpeedStacks G5 Stackmat タイマーの挙動を再現します。

![内部構造のイメージ](images/内部構造のイメージ.jpeg)

## 概要

SpeedStacks Stackmat と同様の操作方式:

- 両手をパッドに置く → タイマーリセット → 準備完了
- 両手を離す → スタート
- 両手を戻す → ストップ

```
┌──────────────────────────────────────────┐
│         ┌──────────────┐                 │
│         │  00.000 秒   │  [RST]          │
│         └──────────────┘                 │
│                                          │
│   ┌──────────┐        ┌──────────┐      │
│   │  左手     │        │  右手     │      │
│   │ (タッチ)  │        │ (タッチ)  │      │
│   └──────────┘        └──────────┘      │
└──────────────────────────────────────────┘
          3Dプリント筐体
```

## 動作フロー（Stackmat準拠）

```
                    ┌──[RST押下]──┐
                    ↓             │
[IDLE] ─(両手押下)→ [READY] ─(ホールド0.5秒)→ [SET]
                                                │
                                          (両手リリース)
                                                ↓
[IDLE] ←─(結果表示)── [STOPPED] ←─(両手押下)── [RUNNING]
```

| 状態        | OLED表示                   | 動作                              |
| :---------- | :------------------------- | :-------------------------------- |
| **IDLE**    | 前回タイム + Best/Avg      | 入力待ち                          |
| **READY**   | "0.000"                    | 両手がパッドを押している          |
| **SET**     | "0.000" (点滅) + ビープ    | 0.5秒ホールド完了。離すとスタート |
| **RUNNING** | カウントアップ中           | 計測中                            |
| **STOPPED** | 最終タイム + Best/Avg of 5 | 記録保存。次の計測待ち            |

## パーツリスト

### メイン部品

| #   | パーツ                    | 型番 / 仕様                | Amazon検索キーワード            | 概算価格             | 備考           |
| --- | :------------------------ | :------------------------- | :------------------------------ | :------------------- | :------------- |
| 1   | **Arduino Nano**          | ATmega328P互換 (USB-C推奨) | 「Arduino Nano 互換 USB-C」     | ¥500〜800            | 制御メイン     |
| 2   | **OLEDディスプレイ**      | 1.3インチ I2C SSD1306      | 「OLED 1.3インチ I2C」          | ¥500〜800            | タイム表示     |
| 3   | **タッチセンサー** ×2     | TTP223 静電容量式          | 「TTP223 タッチセンサー」       | ¥300〜500 (複数個入) | 左右の手パッド |
| 4   | **キーボードスイッチ** ×1 | Cherry MX互換 (手持ちから) | —                               | ¥0                   | リセットボタン |
| 5   | **キーキャップ** ×1       | 1U (リセット用)            | 「キーキャップ 無刻印」         | ¥300〜500            | リセット用     |
| 6   | **アクティブブザー**      | 5V                         | 「アクティブブザー 5V Arduino」 | ¥300                 | ビープ音       |
| 7   | **トグルスイッチ**        | ミニトグル ON/OFF (SPST)   | 「ミニ トグルスイッチ ON OFF」  | ¥200〜400            | 電源ON/OFF     |

### 電源 (いずれか)

| 方式                  | パーツ                         | 概算価格    | メリット                       |
| :-------------------- | :----------------------------- | :---------- | :----------------------------- |
| **A. USB給電**        | USB-Cケーブル (手持ち)         | ¥0          | 最もシンプル。充電不要         |
| **B. 電池駆動**       | 単4×3本 電池ボックス + 単4電池 | ¥500〜800   | ケーブル不要。持ち運び◎        |
| **C. LiPoバッテリー** | 3.7V LiPo + 充電モジュール     | ¥800〜1,200 | 薄型化。ただし回路が複雑になる |

> 💡 **おすすめ:** 最初は **A. USB給電** で作って動作確認。後からBかCに拡張。

### その他

| パーツ   | 備考                          |
| :------- | :---------------------------- |
| **筐体** | 3Dプリント (PLA or PETG)      |
|          | **総額: 約 ¥2,000 〜 ¥3,000** |

## 入力デバイスの配置

```
┌──────────┐        ┌──────────┐        ┌────┐
│  左手     │        │  右手     │        │RST │
│ (タッチ)  │        │ (タッチ)  │        └────┘
└──────────┘        └──────────┘      キーボード
 TTP223               TTP223           スイッチ
```

- 左手/右手パッド: TTP223タッチセンサー。触れるだけで反応（Stackmat準拠）
- リセットボタン: キーボードスイッチ（意図的に押す操作 → 誤操作防止）
- 左右両方にタッチして初めて「両手検知」と判定
- タッチセンサーは筐体表面に銅テープ等で接触面を拡大可能

## 配線図

```
Arduino Nano
├── A4 (SDA) ─────── OLED SDA
├── A5 (SCL) ─────── OLED SCL
├── D2 ──────────── タッチセンサー (左手) SIG
├── D3 ──────────── タッチセンサー (右手) SIG
├── D4 ──────────── リセットスイッチ ──── GND   ※INPUT_PULLUP使用
├── D8 ──────────── ブザー SIG
├── 5V ──────────── OLED VCC / タッチセンサー VCC / ブザー VCC
├── GND ─────────── OLED GND / タッチセンサー GND / ブザー GND
│
└── VIN ←─[トグルスイッチ]─── 電源+ (USB or 電池)
```

> **補足:** TTP223はタッチ時にHIGH出力。リセットスイッチはArduino Nanoの `INPUT_PULLUP` を使うのでGND直結でOK。

## ソフトウェア設計

### 記録管理

- 直近の solve タイムを最大100件メモリに保持 (EEPROM or SRAM)
- Best (自己ベスト)
- Avg of 5: 直近5回の平均（最速・最遅を除いた3回の平均 = 競技ルール）
- Avg of 12: 直近12回の平均（最速・最遅を除いた10回の平均）

### 必要なライブラリ

- `Adafruit_SSD1306` — OLEDディスプレイ制御
- `Adafruit_GFX` — グラフィックス描画
- `Wire` — I2C通信 (標準ライブラリ)

## 3Dプリント筐体

### 設計方針

- **SpeedStacks G5風の横長フォームファクター**
- 2パーツ構成: ベース + トップカバー
- OLEDの窓穴 (中央)
- タッチセンサー (TTP223) の取り付けスペース (左右)
- タッチ面: 銅テープ or 導電性塗料で接触面を拡大
- キーボードスイッチのマウントホール (Cherry MX互換: 14mm角) — リセットボタン用
- リセットボタン位置: 右上 (誤操作防止)
- トグルスイッチ: 側面 or 背面
- USB-Cアクセス用の開口部 (背面)
- 底面にゴム足用の穴 (滑り防止 — 重要！タイムアタック中に動くと困る)

### 推奨素材

- **筐体:** PLA (十分な強度)
- **タッチパッド面:** 銅テープ貼付 or 導電性フィラメント

## 組み立て手順

1. パーツ購入 & 到着待ち
2. 筐体を3Dプリント
3. ブレッドボードで仮組み & ファームウェア動作確認
4. はんだ付けで本配線（Pinecil V2 出番！🔥）
5. 筐体に組み込み
6. 完成 & テスト 🎉

## フォルダ構造

```
cube-timer/
├── README.md          ← このファイル
├── firmware/          ← Arduinoスケッチ
│   └── cube_timer/
│       └── cube_timer.ino
├── models/            ← 3Dモデル (STL, 3MF, CAD)
│   ├── case_base.stl
│   ├── case_top.stl
│   └── pad_cover.stl
└── docs/              ← 回路図、写真など
    └── wiring.md
```
