# 詳細セットアップ・設定ガイド (Setup & Config Manual)

ソフトウェアの導入から、性能を最大限に引き出すための最適化・トラブルシューティングまでを記載します。

## 1. ソフトウェアの導入

（[Release](https://github.com/onlaj/Piano-LED-Visualizer/releases) から専用イメージを使うのが最短ですが、ここでは手動構築のポイントを補足します）

### Python環境の注意

本プロジェクトは外部ハードウェアを直接制御するため、`sudo` 権限での実行や、GPIO用の特別なライブラリ選定が必要です。

- **rpi_ws281x**: Raspberry PiのPWM/DMA機能を利用して高速にLEDデータを送出します。

## 2. Webインターフェースの詳細設定

ブラウザで `http://raspberrypi.local` (初期設定時は `192.168.4.1`) にアクセスして設定を行います。

### 2.1 「Settings」タブの勘所

- **LED Count**: 実際に繋いだLEDの数を正確に入力してください。多いとデータ送信時間が延びてレイテンシが増え、少ないと端が光りません。
- **MIDI Input**: 複数のMIDI機器がある場合、ここで電子ピアノを明示的に選択します。
- **Brightness**: 常時100%にすると電源負荷が高まるため、50-70%程度から始めるのが安全です。

## 3. トラブルシューティング (故障・不具合かな？と思ったら)

| 症状                     | 推測される原因                     | 対策                                            |
| :----------------------- | :--------------------------------- | :---------------------------------------------- |
| **LEDが全く光らない**    | GNDが共通化されていない / 配線ミス | ラズパイとLEDのGNDを再度確認する                |
| **色が激しく点滅する**   | 信号レベルの不足                   | レベルシフタ (74AHCT125) を導入する             |
| **末端の色が黄色っぽい** | 電圧降下                           | テープの反対側からも5V/GNDを供給する (電力注入) |
| **演奏と光がズレる**     | 処理負荷が高い                     | 不要なフォアグラウンドプロセスを停止する        |

## 4. 発展：アニメーションモードの理解

本プロジェクトは単なる点灯だけでなく、以下のようなモードが楽しめます。

- **Velocity Mode**: 鍵盤を叩く強さに応じて、LEDの輝度や色を変化させます。
- **Fading**: 離鍵後に余韻を残すように消灯させます。
- **Background Layer**: 演奏していない時に、全体の雰囲気を盛り上げるバックグラウンドアニメーションを重畳させます。
